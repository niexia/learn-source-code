<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React 基础 | 源码学习</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/learn-source-code/favicon.ico">
    <meta name="description" content="Vue | React 源码学习">
    
    <link rel="preload" href="/learn-source-code/assets/css/0.styles.c8f043b9.css" as="style"><link rel="preload" href="/learn-source-code/assets/js/app.e31e0db2.js" as="script"><link rel="preload" href="/learn-source-code/assets/js/2.0f9babf1.js" as="script"><link rel="preload" href="/learn-source-code/assets/js/13.327c58a4.js" as="script"><link rel="preload" href="/learn-source-code/assets/js/5.601c0259.js" as="script"><link rel="prefetch" href="/learn-source-code/assets/js/10.75239088.js"><link rel="prefetch" href="/learn-source-code/assets/js/11.9ef25918.js"><link rel="prefetch" href="/learn-source-code/assets/js/12.f679cde6.js"><link rel="prefetch" href="/learn-source-code/assets/js/14.41981968.js"><link rel="prefetch" href="/learn-source-code/assets/js/15.27ff814c.js"><link rel="prefetch" href="/learn-source-code/assets/js/16.45a13a5b.js"><link rel="prefetch" href="/learn-source-code/assets/js/17.f8768f9a.js"><link rel="prefetch" href="/learn-source-code/assets/js/18.7b295381.js"><link rel="prefetch" href="/learn-source-code/assets/js/19.c19b4b5a.js"><link rel="prefetch" href="/learn-source-code/assets/js/20.a5959386.js"><link rel="prefetch" href="/learn-source-code/assets/js/21.2d31fefd.js"><link rel="prefetch" href="/learn-source-code/assets/js/3.e50c4eba.js"><link rel="prefetch" href="/learn-source-code/assets/js/4.82133233.js"><link rel="prefetch" href="/learn-source-code/assets/js/6.baa84aa3.js"><link rel="prefetch" href="/learn-source-code/assets/js/7.ef0c02e4.js"><link rel="prefetch" href="/learn-source-code/assets/js/8.726d0783.js"><link rel="prefetch" href="/learn-source-code/assets/js/9.e75944e9.js">
    <link rel="stylesheet" href="/learn-source-code/assets/css/0.styles.c8f043b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-source-code/" class="home-link router-link-active"><!----> <span class="site-name">源码学习</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/learn-source-code/vue/" class="nav-link">
  Vue 2
</a></div><div class="nav-item"><a href="/learn-source-code/vue-next/" class="nav-link">
  Vue 3
</a></div><div class="nav-item"><a href="/learn-source-code/react/" class="nav-link router-link-active">
  React
</a></div><div class="nav-item"><a href="https://niexia.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/niexia/learn-source-code" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/learn-source-code/vue/" class="nav-link">
  Vue 2
</a></div><div class="nav-item"><a href="/learn-source-code/vue-next/" class="nav-link">
  Vue 3
</a></div><div class="nav-item"><a href="/learn-source-code/react/" class="nav-link router-link-active">
  React
</a></div><div class="nav-item"><a href="https://niexia.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/niexia/learn-source-code" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>开始</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-source-code/react/getting-start/基础.html" class="active sidebar-link">React 基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-source-code/react/getting-start/基础.html#_1-jsx-语法" class="sidebar-link">1. JSX 语法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-source-code/react/getting-start/基础.html#为什么使用-jsx" class="sidebar-link">为什么使用 JSX</a></li><li class="sidebar-sub-header"><a href="/learn-source-code/react/getting-start/基础.html#virtual-dom" class="sidebar-link">Virtual DOM</a></li></ul></li><li class="sidebar-sub-header"><a href="/learn-source-code/react/getting-start/基础.html#_2-组件" class="sidebar-link">2. 组件</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>组件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-source-code/react/components/深入了解组件.html" class="sidebar-link">深入了解组件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>redux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-source-code/react/redux/深入redux.html" class="sidebar-link">深入 redux</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>hook</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-source-code/react/hook/hook.html" class="sidebar-link">hook</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>响应式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-source-code/react/reactive/响应式.html" class="sidebar-link">响应式原理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react-基础"><a href="#react-基础" class="header-anchor">#</a> React 基础</h1> <p>先看看 react 主要的几个特点</p> <blockquote><ol><li>声明式：以声明式编写 UI，代码更加可靠，且方便调试</li> <li>组件化：构建管理自身状态的封装组件，然后对齐组合以构成复杂 UI。组件的逻辑使用 JavaScript 进行编写而不使用模板，可以轻松的传递数据，并保持 DOM 的分离。</li></ol></blockquote> <p><strong>声明式编程和命令式编程</strong></p> <blockquote><p>命令式编程描述代码如何工作，而声明式编程则表明想要实现什么目的。</p></blockquote> <ul><li><strong>给我来杯啤酒</strong></li></ul> <p>命令式用生活中的一个例子来说，就好比当你去和服务员要一杯啤酒时对服务员做这样的指示：</p> <ol><li>从架子拿一个玻璃杯</li> <li>将杯子放到酒桶前</li> <li>打开酒桶开关，将杯子装满</li> <li>把杯子递给我</li></ol> <p>如果用的是声明式，你只需要说：“请给我一杯啤酒”。使用这种方式来点啤酒，我们需要假设服务员知道如何提供啤酒。这是声明式编程工作的一个重要方面。</p> <ul><li><strong>JavaScript 将数组元素大写字符串转成小写</strong></li></ul> <p>再看看一个 JavaScript 的例子，实现一个将数组中的元素的大写字符串转成小写字符串</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Foo'</span><span class="token punctuation">,</span> <span class="token string">'BAR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['foo', 'bar']</span>
</code></pre></div><p>解决这个问题，用命令式来实现就是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">toLowerCase</span> <span class="token operator">=</span> <span class="token parameter">input</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> input<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    output<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>input<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>首先我们需要定一个数组，然后遍历输入数组的所有元素，把它们转为小写之后 <code>push</code> 新的数组中，最后将新的数组返回。</p> <p>如果使用的是声明式：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">toLowerCase</span> <span class="token operator">=</span> <span class="token parameter">input</span> <span class="token operator">=&gt;</span> input<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>输入的数组的元素会传递到 <code>map</code> 中，然后 <code>map</code> 函数会返回小写值的数组。</p> <p>相对于之前的方法来说，这个更加的优雅、简洁和易读。<strong>另外，声明式编程无需使用变量，也不用在执行过程中持续更新变量的值。事实上，声明式编程往往避免了创建和修改状态。</strong></p> <ul><li><strong>在 React 的 UI 中</strong></li></ul> <p>在开发中实现一个这样的需求，展示带有标记的地图。使用 JavaScript 的实现如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'map'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>   
  zoom<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>    
  center<span class="token operator">:</span> myLatLng<span class="token punctuation">,</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span> 
<span class="token keyword">const</span> marker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>Marker</span><span class="token punctuation">(</span><span class="token punctuation">{</span>   
  position<span class="token operator">:</span> myLatLng<span class="token punctuation">,</span>   
  title<span class="token operator">:</span> <span class="token string">'Hello World!'</span><span class="token punctuation">,</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span> 

marker<span class="token punctuation">.</span><span class="token function">setMap</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span>
</code></pre></div><p>这显然是编程式的，在代码中我们逐条描述了创建地图、创建标志、以及在地图上添加标志的指令。</p> <p>改用 React 组件，那么方式就是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>Gmaps zoom<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span> center<span class="token operator">=</span><span class="token punctuation">{</span>myLatLng<span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Marker position<span class="token operator">=</span><span class="token punctuation">{</span>myLatlng<span class="token punctuation">}</span> title<span class="token operator">=</span><span class="token string">&quot;Hello World!&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Gmaps<span class="token operator">&gt;</span>
</code></pre></div><p>使用声明式，我们只需要描述我们想要的功能，无须列出实现效果的所有步骤。</p> <p>声明式的 UI 使得 React 很容易使用，最终的代码也比较简单，这样产生的 bug 更少。</p> <h2 id="_1-jsx-语法"><a href="#_1-jsx-语法" class="header-anchor">#</a> 1. JSX 语法</h2> <p>所谓的 JSX，就是 JavaScript 的语法扩展(eXtension)。它看起来和 HTML 比较类似，但它并不局限于 HTML 中的元素</p> <ul><li>它的元素可以是任何一个 React 组件。React 判断一个元素是 HTML 元素还是 React 组件的原则就是看第一个字母是否是大写。</li> <li>在 JSX 可以通过 onClick 这样的方式给一个元素添加一个事件处理函数。当然在 HTML 中也可以用 onclick，但在 HTML 中直接写 onclick 一直就是为人诟病的，会容易让人混乱，比较倡导使用 jQuery 的方法来添加处理函数。</li></ul> <p>使用的是 JSX 语法，最后经过 babel 编译成 JavaScript 来执行。</p> <h3 id="为什么使用-jsx"><a href="#为什么使用-jsx" class="header-anchor">#</a> 为什么使用 JSX</h3> <p>既然不推荐在 HTML 直接使用 onclick，那为什么 JSX 中我们缺使用这样的方式来添加事件处理函数呢？</p> <p>以前我们</p> <ul><li>用 HTML 来代表内容</li> <li>用 CSS 来代表样式</li> <li>用 JavaScript 来定义交互行为</li></ul> <p>然后将这三种语言分在不同的文件中，实际上是“把技术分开管理，而不是分而治之”。</p> <p>React 认为<strong>渲染逻辑本质和其他的 UI 逻辑有内在耦合</strong>，比如 UI 中需要绑定事件，在某些状态更新需要通知 UI。React 没有将标记（HTML）与逻辑进行分离到不同文件中这种人为的分离方式，<strong>而是通过将两者放在称为“组件”的松散耦合单元中，来实现关注点的分离</strong>。</p> <p>做同一件事的代码应该高耦合，应该把实现这个功能的所有代码集中在一个文件里。除了在组件中定义交互行为，还可以在 React 组件中定义样式。</p> <p>通过 React 组件可以把 JavaScript、HTML 和 CSS 的功能都写在一个文件中，实现了真正的组件封装。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">List</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onClickButton <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onClickButton</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">onClickButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> countStyle <span class="token operator">=</span> <span class="token punctuation">{</span>
      fontSize<span class="token operator">:</span> <span class="token string">'14px'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;list&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onClickButton<span class="token punctuation">}</span><span class="token operator">&gt;</span>Click Me<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span>countStyle<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          Click Count<span class="token operator">:</span> <span class="token operator">&lt;</span>span id<span class="token operator">=</span><span class="token string">&quot;clickCount&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>会被编译成</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>className<span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token comment">/*... h1 children */</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token comment">/*... ul children */</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div><p>最后会创建这样的对象，它们就是“react 的元素”，描述你所在页面上看到的内容。react 通过读取这些对象，用来创建最后的 DOM，并保持随时更新。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    className<span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">//...</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="virtual-dom"><a href="#virtual-dom" class="header-anchor">#</a> Virtual DOM</h3> <p>接下来我们看看 react 的工作理念是怎么样的。这里我们用 jQuery 来对比一下</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>clickMe<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Click Me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Click Count: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>clickCount<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://code.jquery.com/jquery-1.12.4.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./clickCounter.js&quot;</span><span class="token operator">&gt;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

// clickCounter.js
$(function() {
  $('#clickMe').click(function() {
    const $clickCount = $('#clickCount');
    const count = parseInt($clickCount.text(), 10);
    $clickCount.text(count + 1); 
  })
})
</code></pre></div><p>在👆这种实现的方式中，是一种命令式的方式，首先我们找到了按钮，然后挂上一个匿名函数。在事件的处理函数中，选中那个需要修改的 DOM 元素，读取其中的文本值，加 1 之后，修改这个 DOM 元素。</p> <p>这种方式确实比较容易理解，不过在大型项目中，这种模式会造成代码结构复杂难以维护。</p> <p><strong>而 React 相对会更加“高级”，我们并不需要“选中一些 DOM 然后做一些事情的操作”。我们只需要关心“我想要显示什么”，而不用操心“怎么做”。</strong></p> <p><strong>React 的理念，可以归结为一个公式</strong></p> <div class="language- extra-class"><pre class="language-text"><code>UI = render(data)
</code></pre></div><ul><li>UI 就是用户界面，它是 render 函数执行的结果</li> <li>render 是一个纯函数，只接受 data（数据）</li></ul> <p>用户看到的界面完全取决于输入的数据。当我们想要更新页面的时候，要做的就是更新数据，用户界面就会自动的作出响应，这也是 React 为什么叫 React 的原因。</p> <p>在每次 render 函数被调用时，并不是简单的把整个组件重新绘制一次，因为那样明显是比较浪费的。React 利用了 Virtual DOM，让每次渲染时只重新渲染最少的 DOM。</p> <ol><li>DOM 是结构化文本（HTML文本）的抽象表达形式，每个 HTML 中的元素都对应一个 DOM 节点，基于这种形式，DOM 节点自然就构成了一个树形结构——DOM树。</li> <li>浏览器为了渲染 HTML，会先用 HTML 来构建 DOM 树，然后根据 DOM 树渲染用户看见的界面，当需要修改界面时，就去修改 DOM 树上的节点。</li> <li>为了提升性能，我们需要“减少 DOM 操作”。因为一个 DOM 操作，可能会引起浏览器对网页进行重新布局、绘制</li> <li>React 不会直接将 JSX 语句用来构建 DOM 树，而是构建 Virtual DOM。DOM 树是 HTML 的抽象，那么 Virtual DOM 就是 DOM 树的抽象。它不会直接触及浏览器，而只是存在 JavaScript 空间的一个树形结构。</li> <li>每次渲染时，会对比这一次产生的 Virtual DOM 和上一次渲染的 Virtual DOM，如果发现差别，修改真正的 DOM 树时只需要修改差别中的部分就行。</li></ol> <p>所以在上面的计数中，当用户点击之后，这一次的重新渲染，实际也只会更新 span 元素中的内容而已 0 -&gt; 1。</p> <h2 id="_2-组件"><a href="#_2-组件" class="header-anchor">#</a> 2. 组件</h2> <p>React 的组件使用的是一个名为 <code>render()</code> 方法。</p> <ul><li>可以<strong>向组件传递参数</strong>，组件内部可以通过  <code>this.props</code> 获取。</li> <li>组件内部也可以维护自己的状态，可以通过 <code>this.state</code> 访问，当组件的数据变化时，组件<strong>会再次调用</strong> <code>render()</code> 方法重新渲染更新</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TodoApp</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 定义自己的状态</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> items<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handleChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleSubmit</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span><span class="token constant">TODO</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>TodoList items<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>items<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">&quot;new-todo&quot;</span><span class="token operator">&gt;</span>
            What needs to be done<span class="token operator">?</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>input
            id<span class="token operator">=</span><span class="token string">&quot;new-todo&quot;</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span>
            value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>text<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>
            Add #<span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>items<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 更新 state，重新进行渲染</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>text<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> newItem <span class="token operator">=</span> <span class="token punctuation">{</span>
      text<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
      id<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      items<span class="token operator">:</span> state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>newItem<span class="token punctuation">)</span><span class="token punctuation">,</span>
      text<span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TodoList</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>TodoApp <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'todos-example'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这里还有几个小知识🤔️</p> <ul><li><code>import</code> 了  <code>Component</code>，<code>Component</code> 作为所有组件的基类，提供了很多组件共有的功能。可以通过 <code>extents Component</code> 来创建组件类</li> <li>另外我们有必要 <code>import React</code>，看起来没有被用到？事实上这很有必要，在使用 JSX 的代码文件中，即使我们用不到 <code>React</code>，也需要将它倒入，因为 JSX 最后会被编译成依赖于 <code>React</code> 的表达式。例如前面看到的<code>React.createElement</code></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/niexia/learn-source-code/edit/master/docs/react/getting-start/基础.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/22/2021, 6:44:52 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/learn-source-code/react/components/深入了解组件.html">
        深入了解组件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/learn-source-code/assets/js/app.e31e0db2.js" defer></script><script src="/learn-source-code/assets/js/2.0f9babf1.js" defer></script><script src="/learn-source-code/assets/js/13.327c58a4.js" defer></script><script src="/learn-source-code/assets/js/5.601c0259.js" defer></script>
  </body>
</html>
